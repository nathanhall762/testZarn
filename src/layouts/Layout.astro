---
import ContactSection from '../components/shared/ContactSection';
import type { DocumentData } from 'firebase/firestore';
import ReviewCards from '../components/ReviewCards';
import type { Review } from '../components/ReviewCards';
import { getData } from '../firebase';
import PageBuilder from '../components/shared/PageBuilder.astro';
import BaseLayout from './BaseLayout.astro';

export interface Item {
  type: string;
  value: any;
}

interface Props {
  title: string;
  metaDescription: string;
  pageData: DocumentData;
}

const businessInformation = await getData('business_information');

const { title, metaDescription, pageData } = Astro.props;

const testReview: Review = {
  name: 'fake',
  authorAttribution: { displayName: 'fake person', photoUri: '', uri: '' },
  originalText: { languageCode: 'en', text: 'this is great' },
  publishTime: 'idk',
  rating: 5,
  text: { languageCode: 'en', text: 'this is great' },
  relativePublishTimeDescription: 'thsi is great',
};

let reviews;
if (import.meta.env.PROD === true) {
  const { reviewData } = await import('../googleReviews');
  reviews = reviewData;
} else {
  reviews = Array(5).fill(testReview);
}

const currentPath = Astro.url.pathname;
---

<BaseLayout title={title} metaDescription={metaDescription}>
  <PageBuilder pageData={pageData} />
  <slot />
  <ReviewCards heading='Reviews' reviews={reviews} />
  <ContactSection
    businessName={businessInformation[0].business_name}
    businessAddress={businessInformation[0].business_address}
    businessPhone={businessInformation[0].business_phone}
    businessEmail={businessInformation[0].business_contact_email}
    currentPath={currentPath}
    client:idle
  />
</BaseLayout>
